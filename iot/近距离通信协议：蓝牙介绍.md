# 近距离通信协议：蓝牙介绍

## 起源

蓝牙的名字来源于10世纪丹麦国王Harald Blatand -英译为Harold Bluetooth(因为他十分喜欢吃蓝梅,所以牙齿每天都带着蓝色)。他将当时的瑞典、芬兰与丹麦统一起来。用他的名字来命名这种新的技术标准，含有将四分五裂的局面统一起来的意思。

1998年5月，爱立信、诺基亚、东芝、IBM和英特尔公司等五家著名厂商，在联合开展短程无线通信技术的标准化活动时提出了蓝牙技术，其宗旨是提供一种短距离、低成本的无线传输应用技术。

##  蓝牙技术的规范及特点

蓝牙技术是一种无线数据与语音通信的开放性全球规范，工作在全球通用的2.4GHz ISM(即工业、科学、医学）频段，标准是IEEE802.15，工作在2.4GHz频带，带宽为1Mb/s。

它以低成本的近距离无线连接为基础，为固定与移动设备通信环境建立一个特别连接。以时分方式进行全双工通信，其基带协议是电路交换和分组交换的组合。一个跳频频率发送一个同步分组，每个分组占用一个时隙，使用扩频技术也可扩展到5个时隙。 同时，蓝牙技术支持1个异步数据通道或3个并发的同步话音通道，或1个同时传送异步数据和同步话音的通道。每一个话音通道支持64kb/s的同步话音；异步通道支持最大速率为721kb/s，反向应答速率为57. 6 kb/s的非对称连接，或者是432. 6 kb/s的对称连接。

依据发射输出电平功率不同，蓝牙传输有3种距离等级：
- Class1为100m左右
- Class2约为10m
- Class3约为2-3m

一般情况下，其正常的工作范围是10m半径之内。在此范围内，可进行多台设备间的互联。

## 蓝牙版本

目前蓝牙发展到了蓝牙5.0：

下面对现阶段主要版本蓝牙技术的特性做一个详细的介绍：

### 版本1.1

传输率约在748~810kb/s，因是早期设计，容易受到同频率之间的类似通信产品干扰，影响通讯质量。这个初始版本支持Stereo音效的传输要求，但只能够以（单工）方式工作，加上带宽频率响应等指标不理想，并未算是最好的Stereo传输工具。

### 版本1.2

同样是只有748~810kb/s的传输率，但增加了(改善Software)抗干扰跳频功能。支持Stereo音效的传输要求，但只能够作（单工）方式工作，加上带宽频率响应还是不理想，也不能作为立体声（Stereo）传输工具。

### 版本2.0

2.0是1.2的改良提升版，传输率约在1.8M/s~2.1M/s，可以有（双工）的工作方式。即一边作语音通讯，同时亦可以传输档案/高质素图片，2.0版本当然也支持Stereo运作。随后蓝牙2.0版本的芯片，增加了Stereo译码芯片，则连A2DP（Advanced Audio Distribution Profile）也可以不需要了。

### 版本2.1

为了改善蓝牙技术存在的问题，蓝牙SIG组织（Special Interest Group）推出了Bluetooth 2.1+EDR版本的蓝牙技术。改善装置配对流程：以往在连接过程中，需要利用个人识别码来确保连接的安全性，而改进过后的连接方式则是会自动使用数字密码来进行配对与连接，举例来说，只要在手机选项中选择连接特定装置，在确定之后，手机会自动列出当前环境中可使用的设备，并且自动进行连结；而短距离的配对方面：也具备了在两个支持蓝牙的手机之间互相进行配对与通讯传输的NFC（Near Field Communication）机制；更佳的省电效果：蓝牙2.1版加入了SniffSubrating的功能，透过设定在2个装置之间互相确认讯号的发送间隔来达到节省功耗的目的。蓝牙2.1将装置之间相互确认的讯号发送时间间隔从旧版的0.1秒延长到0.5秒左右，如此可以让蓝牙芯片的工作负载大幅降低，也可让蓝牙可以有更多的时间可以彻底休眠。根据官方的报告，采用此技术之后，蓝牙装置在开启蓝牙联机之后的待机时间可以有效延长5倍以上，开始支持全双工通信模式。

### 版本3.0+HS

2009年4月21日，蓝牙技术联盟(BluetoothSIG)正式颁布了新一代标准规范"BluetoothCoreSpecificationVersion3.0HighSpeed"(蓝牙核心规范3.0版高速)，蓝牙3.0的核心是"Generic Alternate MAC/PHY"(AMP)，这是一种全新的交替射频技术，允许蓝牙协议栈针对任一任务动态地选择正确射频。最初被期望用于新规范的技术包括802.11以及UMB，但是新规范中取消了UMB的应用。

作为新版规范，蓝牙3.0的传输速度自然会更高，而秘密就在802.11无线协议上。通过集成"802.11PAL"(协议适应层)，蓝牙3.0的数据传输率提高到了大约24Mbps(即可在需要的时候调用802.11WI-FI用于实现高速数据传输)，是蓝牙2.0的八倍，可以轻松用于录像机至高清电视、PC至PMP、UMPC至打印机之间的资料传输。

功耗方面，通过蓝牙3.0高速传送大量数据自然会消耗更多能量，但由于引入了增强电源控制(EPC)机制，再辅以802.11，实际空闲功耗会明显降低，蓝牙设备的待机耗电问题有望得到初步解决。

此外，新的规范还具备通用测试方法(GTM)和单向广播无连接数据(UCD)两项技术，并且包括了一组HCI指令以获取密钥长度。据称，配备了蓝牙2.1模块的PC理论上可以通过升级固件让蓝牙2.1设备也支持蓝牙3.0。联盟成员已经开始为设备制造商研发蓝牙3.0解决方案。

### 蓝牙4.0

（1）简介

蓝牙4.0为蓝牙3.0的升级标准蓝牙4.0最重要的特性是省电，极低的运行和待机功耗可以使一粒纽扣电池连续工作数年之久。此外，低成本和跨厂商互操作性，3毫秒低延迟、AES-128加密等诸多特色，可以用于计步器、心律监视器、智能仪表、传感器物联网等众多领域，大大扩展蓝牙技术的应用范围。

（2）主要特点

蓝牙4.0是蓝牙3.0+HS规范的补充，专门面向对成本和功耗都有较高要求的无线方案，可广泛用于卫生保健、体育健身、家庭娱乐、安全保障等诸多领域。它支持两种部署方式：双模式和单模式。双模式中，低功耗蓝牙功能集成在现有的经典蓝牙控制器中，或再在现有经典蓝牙技术(2.1+EDR/3.0+HS)芯片上增加低功耗堆栈，整体架构基本不变，因此成本增加有限。

Single mode只能与BT4.0互相传输无法向下兼容（与3.0/2.1/2.0无法相通）；Dual mode可以向下兼容可与BT4.0传输也可以跟3.0/2.1/2.0传输。单模式面向高度集成、紧凑的设备，使用一个轻量级连接层(Link Layer)提供超低功耗的待机模式操作、简单设备恢复和可靠的点对多点数据传输，还能让联网传感器在蓝牙传输中安排好低功耗蓝牙流量的次序，同时还有高级节能和安全加密连接。

（3）优点

蓝牙4.0将三种规格集一体，包括传统蓝牙技术、高速技术和低耗能技术，与3.0版本相比最大的不同就是低功耗。“4.0版本的功耗较老版本降低了90%，更省电，“随着蓝牙技术由手机、游戏、耳机、便携电脑和汽车等传统应用领域向物联网、医疗等新领域的扩展，对低功耗的要求会越来越高。4.0版本强化了蓝牙在数据传输上的低功耗性能。”

### 蓝牙4.1

（1）简介

如果说蓝牙4.0主打的是省电特性的话，那么此次升级蓝牙4.1的关键词应当是IOT（全联网），也就是把所有设备都联网的意思。为了实现这一点，对通讯功能的改进是蓝牙4.1最为重要的改进之一。

（2）主要特点

- 批量数据的传输速度

首当其冲的就是批量数据的传输速度，大家知道蓝牙的传输速率一直非常渣，与已经跨入千兆的Wi-Fi相比毫无可比性。所以蓝牙4.1在已经被广泛使用的蓝牙4.0 LE基础上进行了升级，使得批量数据可以以更高的速率传输。

当然这并不意味着可以用蓝牙高速传输流媒体视频，这一改进的主要针对的还是刚刚兴起的可穿戴设备。例如已经比较常见的健康手环，其发送出的数据流并不大，通过蓝牙4.1能够更快速地将跑步、游泳、骑车过程中收集到的信息传输到手机等设备上，用户就能更好地实时监控运动的状况，这是很有用处的。

在蓝牙4.0时代，所有采用了蓝牙4.0 LE的设备都被贴上了“Bluetooth Smart”和“Bluetooth SmartReady”的标志。其中Bluetooth Smart Ready设备指的是PC、平板、手机这样的连接中心设备，而Bluetooth Smart设备指的是蓝牙耳机、键鼠等扩展设备。之前这些设备之间的角色是早就安排好了的，并不能进行角色互换，只能进行1对1连接。而在蓝牙4.1技术中，就允许设备同时充当“Bluetooth Smart”和“Bluetooth Smart Ready”两个角色的功能，这就意味着能够让多款设备连接到一个蓝牙设备上。

举个例子，一个智能手表既可以作为中心枢纽，接收从健康手环上收集的运动信息的同时，又能作为一个显示设备，显示来自智能手机上的邮件、短信。借助蓝牙4.1技术智能手表、智能眼镜等设备就能成为真正的中心枢纽。

- 通过IPV6连接到网络

除此之外，可穿戴设备上网不易的问题，也可以通过蓝牙4.1进行解决。新标准加入了专用通道允许设备通过IPv6联机使用。举例来说，如果有蓝牙设备无法上网，那么通过蓝牙4.1连接到可以上网的设备之后，该设备就可以直接利用IPv6连接到网络，实现与WiFi相同的功能。尽管受传输速率的限制，该设备的上网应用有限，不过同步资料、收发邮件之类的操作还是完全可以实现的。这个改进的好处在于传感器、嵌入式设备只需蓝牙便可实现连接手机、连接互联网，相对而言WiFi多用于连接互联网，在连接设备方面效果一般，无法做到蓝牙的功能。未来随着物联网逐渐走进我们的生活，无线传输在日常生活中的地位也会越来越高，蓝牙作为普及最广泛的传输方式，将在“物联网”中起到不可忽视的作用。不过，蓝牙完全适应IPv6则需要更长的时间，所以就要看芯片厂商如何帮助蓝牙设备增加IPv6的兼容性了。

- 简化设备连接

在各大手机厂商以及PC厂商的推动下，几乎所有的移动设备和笔记本电脑中都装有蓝牙的模块，用户对于蓝牙的使用也比较多。不过仍有大量用户觉得蓝牙使用起来很麻烦，归根结底还是蓝牙设备较为复杂的配对、连接造成的。试想一下，如果与手机连接的智能手表，每次断开连接后，都得在设置界面中手动选择一次才能重新连接，这就非常麻烦了。之前解决这一问题的方法是厂商在两个蓝牙设备中都加入NFC芯片，通过NFC近场通讯的方式来简化重新配对的步骤，这本是个不错的思路。只是搭载NFC芯片的产品不仅数量少，而且价格偏高，非常小众。

蓝牙4.1针对这点进行了改进，对于设备之间的连接和重新连接进行了很大幅度的修改，可以为厂商在设计时提供更多的设计权限，包括设定频段创建或保持蓝牙连接，这以改变使得蓝牙设备连接的灵活性有了非常明显的提升。两款带有蓝牙4.1的设备之前已经成功配对，重新连接时只要将这两款设备靠近，即可实现重新连接，完全不需要任何手动操作。举个例子，以后使用蓝牙4.1的耳机时，只要打开电源开关就行了，不需要在手机上进行操作，非常的简单。

- 与4G和平共处

在移动通信领域，近期最火的话题莫过于4G了，已经成为全球无线通信网络一个不可逆转的发展趋势。而蓝牙4.1也专门针对4G进行了优化，确保可以与4G信号和平共处，这个改进被蓝牙技术联盟称为“共存性”。可能大家会觉得疑惑，手机网络信号和蓝牙不是早就共存了么，为什么蓝牙4.1还要特别针对这点改进呢？这是因为在实际的应用中，如果这两者同时传输数据，那么蓝牙通信就可能受到手机网络信号的干扰，导致传输速率的下降。因此在全新的蓝牙4.1标准中，一旦遇到蓝牙4.1和4G网络同时在传输数据的情况，那么蓝牙4.1就会自动协调两者的传输信息，从而减少其它信号对蓝牙4.1的干扰，用户也就不用担心传输速率下降的问题了。

- 蓝牙4.1提供的增强功能

包括：
AES加密技术提供更安全的连接。该功能使无线耳机更加适用于政府、医疗及银行等安全至上的应用领域。
可通过专属Bluetooth Smart远程遥控器操控耳机、扬声器及条形音箱，并支持同步播放源于另一个完全不同设备的音频流。

### 蓝牙4.2

2014年12月4日，蓝牙4.2标准颁布，改善了数据传输速度和隐私保护程度，可直接通过IPv6和6LoWPAN接入互联网。在新的标准下蓝牙信号想要连接或者追踪用户设备必须经过用户许可，否则蓝牙信号将无法连接和追踪用户设备。

速度方面变得更加快速，两部蓝牙设备之间的数据传输速度提高了2.5倍，因为蓝牙智能（Bluetooth Smart）数据包的容量提高，其可容纳的数据量相当于此前的10倍左右。

### 蓝牙5.0

于美国时间2016年6月16日在伦敦正式发布,为现阶段最高级的蓝牙协议标准。蓝牙5.0有以下特点：

（1）更快的传输速度

蓝牙5.0的开发人员称，新版本的蓝牙传输速度上限为2Mbps，是之前4.2LE版本的两倍。当然，你在实际生活中是不太可能达到这个极限速度的，但是仍然可以体验到显著的速度提升。

（2）更远的有效距离

蓝牙5.0的另外一个重要改进是，它的有效距离是上一版本的4倍，因此在理论上，当你拿着手机站在距离蓝牙音箱300米的地方，它还是会继续放着你爱的歌。也就是说，理论上，蓝牙发射和接收设备之间的有效工作距离可达300米。当然，实际的有效距离还取决于你使用的电子设备。

（3）导航功能

蓝牙5.0将添加更多的导航功能，因此该技术可以作为室内导航信标或类似定位设备使用，结合Wi-Fi可以实现精度小于1米的室内定位。举个例子，如果你是路痴，你仍可以使用蓝牙技术，在诺大的商业中心找到路。

（4）物联网功能

物联网还在持续火爆，因此，蓝牙5.0针对物联网进行了很多底层优化，力求以更低的功耗和更高的性能为智能家居服务。

（5）升级硬件

此前的一些蓝牙版本更新只要求升级软件，但蓝牙5.0很可能要求升级到新的芯片。不过，旧的硬件仍可以兼容蓝牙5.0，你就无法享用其新的性能了。搭载蓝牙5.0芯片的旗舰级手机将于2017年问世，相信中低端手机也将陆陆续续内置蓝牙5芯片。苹果将为成为第一批使用该项技术的厂商之一。

（6）更多的传输功能

全新的蓝牙5.0能够增加更多的数据传输功能，硬件厂商可以通过蓝牙5.0创建更复杂的连接系统，比如Beacon或位置服务。因此通过蓝牙设备发送的广告数据可以发送少量信息到目标设备中，甚至无需配对。

（7）更低的功耗

众所周知，蓝牙是智能手机的必备功能，随着智能设备和移动支付等越来越多需要打开蓝牙，才能享受便利功能逐渐融入人们的生活之中，蓝牙的功耗成为了智能手机待机时间的一大杀手。为此蓝牙5.0将大大降低了蓝牙的功耗，使人们在使用蓝牙的过程中再也不必担心待机时间短的问题。

（8）真正支持无损传输

支持24bit/192KHz的无损音源传输，对现有的Wi-Fi高保真无损音频传输形成有效威胁。

## 蓝牙匹配规则

两个蓝牙设备在进行通讯前，必须将其匹配在一起，以保证其中一个设备发出的数据信息只会被经过允许的另一个设备所接受。蓝牙技术将设备分为两种：主设备和从设备。

（1）蓝牙主设备

主设备一般具有输入端。在进行蓝牙匹配操作时，用户通过输入端可输入随机的匹配密码来将两个设备匹配。

蓝牙手机、安装有蓝牙模块的PC等都是主设备。（例如：蓝牙手机和蓝牙PC进行匹配时，用户可在蓝牙手机上任意输入一组数字，然后在蓝牙PC上输入相同的一组数字，来完成这两个设备之间的匹配。）

（2）蓝牙从设备

从设备一般不具备输入端。因此从设备在出厂时，在其蓝牙芯片中，固化有一个4位或6位数字的匹配密码。蓝牙耳机、UD数码笔等都是从设备。（例如：蓝牙PC与UD数码笔匹配时，用户将UD笔上的蓝牙匹配密码正确的输入到蓝牙PC上，完成UD笔与蓝牙PC之间的匹配。）

注意事项：

主设备与主设备之间、主设备与从设备之间，是可以互相匹配在一起的；而从设备与从设备是无法匹配的。

例如：蓝牙PC与蓝牙手机可以匹配在一起；蓝牙PC也可以与UD笔匹配在一起；而UD笔与UD笔之间是不能匹配的。

一个主设备，可匹配一个或多个其他设备。例如：一部蓝牙手机，一般只能匹配7个蓝牙设备。而一台蓝牙PC，可匹配十多个或数十个蓝牙设备。

在同一时间，蓝牙设备之间仅支持点对点通讯。

## 蓝牙应用

蓝牙技术可以应用于日常生活的各个方面，例如，引入蓝牙技术，就可以去掉移动电话与膝上型电脑之间的令人讨厌的连接电缆而而通过无线使其建立通信。

打印机、PDA、桌上型电脑、传真机、键盘、游戏操纵杆以及所有其它的数字设备都可以成为蓝牙系统的一部分。


